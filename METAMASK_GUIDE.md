# ğŸ¦Š MetaMask Integration Guide

## Tá»•ng Quan

CertChain tÃ­ch há»£p MetaMask Ä‘á»ƒ:
- âœ… Káº¿t ná»‘i vÃ­ Ethereum cá»§a báº¡n
- âœ… Tá»± Ä‘á»™ng chuyá»ƒn sang máº¡ng Sepolia testnet
- âœ… KÃ½ transaction phÃ¡t hÃ nh chá»©ng chá»‰
- âœ… Quáº£n lÃ½ Sepolia ETH (testnet)

---

## ğŸ”§ CÃ i Äáº·t MetaMask

### 1. CÃ i Äáº·t Extension

**TrÃªn Chrome/Edge/Brave**:
1. Truy cáº­p: https://metamask.io/download/
2. Chá»n trÃ¬nh duyá»‡t cá»§a báº¡n
3. Nháº¥n "Add to Chrome" (hoáº·c browser tÆ°Æ¡ng á»©ng)
4. Nháº¥n "Add extension"

**TrÃªn Firefox**:
1. Truy cáº­p: https://addons.mozilla.org/en-US/firefox/addon/ether-metamask/
2. Nháº¥n "Add to Firefox"

### 2. Táº¡o VÃ­ Má»›i

1. Má»Ÿ MetaMask extension
2. Nháº¥n "Create a Wallet"
3. Táº¡o password máº¡nh
4. **LÆ°u backup seed phrase á»Ÿ nÆ¡i an toÃ n** (12 tá»«)
5. XÃ¡c nháº­n seed phrase
6. âœ… VÃ­ Ä‘Ã£ sáºµn sÃ ng!

### 3. ThÃªm Sepolia Network (TÃ¹y Chá»n)

MetaMask sáº½ tá»± Ä‘á»™ng thÃªm Sepolia khi káº¿t ná»‘i láº§n Ä‘áº§u, nhÆ°ng báº¡n cÃ³ thá»ƒ thÃªm thá»§ cÃ´ng:

1. Má»Ÿ MetaMask
2. Nháº¥n menu "Networks" (gÃ³c trÃªn cÃ¹ng)
3. Nháº¥n "Add a custom RPC network"
4. Äiá»n thÃ´ng tin:
   - **Network Name**: Sepolia Testnet
   - **RPC URL**: https://ethereum-sepolia.publicnode.com
   - **Chain ID**: 11155111
   - **Currency Symbol**: SepoliaETH
   - **Block Explorer**: https://sepolia.etherscan.io
5. Nháº¥n "Save"

---

## ğŸ’° Láº¥y Sepolia ETH (Testnet)

**Báº¡n cáº§n Sepolia ETH Ä‘á»ƒ gá»­i transaction!**

### CÃ¡ch 1: Alchemy Faucet â­ (Recommended)

1. Truy cáº­p: https://www.alchemy.com/faucets/ethereum-sepolia
2. Sao chÃ©p Ä‘á»‹a chá»‰ vÃ­ MetaMask (Click account menu â†’ Copy)
3. Paste vÃ o form
4. Nháº¥n "Send Me ETH"
5. âœ… Chá» ~1 phÃºt Ä‘á»ƒ nháº­n Sepolia ETH

### CÃ¡ch 2: Infura Faucet

1. Truy cáº­p: https://www.infura.io/faucet/sepolia
2. Nháº­p Ä‘á»‹a chá»‰ vÃ­
3. HoÃ n thÃ nh Captcha
4. âœ… Nháº­n Sepolia ETH

### CÃ¡ch 3: QuickNode Faucet

1. Truy cáº­p: https://faucet.quicknode.com/ethereum/sepolia
2. Káº¿t ná»‘i MetaMask (hoáº·c nháº­p Ä‘á»‹a chá»‰)
3. Nháº¥n "DRIP"
4. âœ… Nháº­n Sepolia ETH

### Kiá»ƒm Tra Sá»‘ DÆ°

- **TrÃªn MetaMask**: Xem sá»‘ dÆ° táº¡i trang chÃ­nh
- **TrÃªn Etherscan**: https://sepolia.etherscan.io/ â†’ Paste Ä‘á»‹a chá»‰ vÃ­

---

## ğŸš€ Sá»­ Dá»¥ng CertChain vá»›i MetaMask

### Step 1: Káº¿t Ná»‘i vÃ­

```
[CertChain Homepage]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ CertChain                       â”‚ [ğŸ¦Š MetaMask]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nháº¥n nÃºt MetaMask á»Ÿ gÃ³c trÃªn bÃªn pháº£i
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
[MetaMask Popup]
"Allow CertChain to access..."
      â†“ Nháº¥n "Connect"
âœ… Káº¿t ná»‘i thÃ nh cÃ´ng!
```

### Step 2: Chá»n Sepolia Network

MetaMask sáº½ tá»± Ä‘á»™ng yÃªu cáº§u chuyá»ƒn sang Sepolia. Nháº¥n "Switch network".

```
ğŸ”´ Hiá»‡n táº¡i: Ethereum Mainnet
   â†“ Nháº¥n "Switch"
ğŸŸ¢ Chuyá»ƒn sang: Sepolia Testnet
   âœ… Sáºµn sÃ ng
```

### Step 3: PhÃ¡t HÃ nh Chá»©ng Chá»‰ (Contract Call)

```
[Issuer Dashboard]
1. Nháº­p Certificate ID: CERT-2026-0001
2. Nháº­p Doc Hash: 0x1234...
3. Nháº¥n "PhÃ¡t HÃ nh TrÃªn Blockchain"
      â†“
[MetaMask Popup]
"Confirm Transaction"
- To: 0x895c3f9770a59F0062171c13395170E39B2dd084
- Gas Fee: ~0.002 SepoliaETH
      â†“ Nháº¥n "Confirm"
      â†“
â³ Transaction Ä‘ang xá»­ lÃ½...
      â†“
âœ… ThÃ nh cÃ´ng! TX: 0x9876...
```

---

## ğŸ“¡ Frontend Code Integration

### Sá»­ Dá»¥ng MetaMask Hook

```typescript
import { useMetaMask } from "@/services/metamask";

export function MyComponent() {
  const {
    account,        // "0xE8AB70..."
    balance,        // "0.5" (in ETH)
    isConnected,    // true/false
    isSepolia,      // true/false
    connect,        // async () => connect wallet
    switchNetwork,  // async () => switch to Sepolia
    signMessage,    // async (msg, addr) => signature
    sendTransaction // async (to, from, data, value) => txHash
  } = useMetaMask();

  return (
    <div>
      {!isConnected && (
        <button onClick={connect}>Connect MetaMask</button>
      )}

      {isConnected && (
        <div>
          <p>Account: {account}</p>
          <p>Balance: {balance} ETH</p>
          <p>Network: {isSepolia ? "Sepolia âœ“" : "Other âš "}</p>
        </div>
      )}
    </div>
  );
}
```

### Gá»­i Transaction

```typescript
const { account, sendTransaction } = useMetaMask();

const issueCertificate = async () => {
  // Encode function call to smart contract
  const encodedData = iface.encodeFunctionData("issue", [
    certificateId,
    docHash,
  ]);

  // Send transaction via MetaMask
  const txHash = await sendTransaction(
    CONTRACT_ADDRESS,  // 0x895c3f9770a59F0062171c13395170E39B2dd084
    account,           // User's address
    encodedData        // Function call
  );

  console.log("Transaction sent:", txHash);
};
```

### KÃ½ Tin Nháº¯n

```typescript
const { account, signMessage } = useMetaMask();

const signCertificate = async (message: string) => {
  const signature = await signMessage(message, account);
  console.log("Signature:", signature);
  // Gá»­i signature lÃªn backend Ä‘á»ƒ xÃ¡c minh
};
```

---

## ğŸ” Security Best Practices

### âœ… LÃ€M

1. âœ… LuÃ´n yÃªu cáº§u ngÆ°á»i dÃ¹ng xÃ¡c nháº­n transaction
2. âœ… Hiá»ƒn thá»‹ contract address trÆ°á»›c khi gá»­i tx
3. âœ… Kiá»ƒm tra gas fee (khÃ´ng quÃ¡ cao)
4. âœ… Giá»¯ seed phrase á»Ÿ nÆ¡i an toÃ n
5. âœ… Sá»­ dá»¥ng testnet (Sepolia) trÆ°á»›c mainnet

### âŒ KHÃ”NG LÃ€M

1. âŒ KhÃ´ng bao giá» chia sáº» seed phrase
2. âŒ KhÃ´ng click link láº¡ tá»« email (phishing)
3. âŒ KhÃ´ng cho phÃ©p website truy cáº­p private key
4. âŒ KhÃ´ng sá»­ dá»¥ng password yáº¿u
5. âŒ KhÃ´ng gá»­i tx cho contract khÃ´ng xÃ¡c minh

---

## ğŸ› Troubleshooting

### Lá»—i: "MetaMask Not Installed"

**Giáº£i PhÃ¡p**:
- CÃ i Ä‘áº·t MetaMask tá»« https://metamask.io/download/
- Kiá»ƒm tra extension Ä‘Ã£ báº­t chÆ°a (Settings â†’ Extensions)

### Lá»—i: "User Rejected Connection"

**Giáº£i PhÃ¡p**:
- Má»Ÿ MetaMask notification
- Nháº¥n "Connect" Ä‘á»ƒ cháº¥p nháº­n

### Lá»—i: "Sepolia Network Not Found"

**Giáº£i PhÃ¡p**:
- MetaMask sáº½ tá»± Ä‘á»™ng thÃªm Sepolia
- Hoáº·c thÃªm thá»§ cÃ´ng (xem hÆ°á»›ng dáº«n trÃªn)

### Lá»—i: "Insufficient Balance"

**Giáº£i PhÃ¡p**:
- Báº¡n cáº§n Sepolia ETH
- Láº¥y tá»« faucet (xem má»¥c trÃªn)
- Cáº§n tá»‘i thiá»ƒu ~0.01 ETH per transaction

### Lá»—i: "Transaction Failed - AlreadyIssued"

**Giáº£i PhÃ¡p**:
- Certificate ID Ä‘Ã£ tá»“n táº¡i trÃªn blockchain
- Sá»­ dá»¥ng certificate ID má»›i vÃ  duy nháº¥t

### KhÃ´ng Thá»ƒ Káº¿t Ná»‘i Ä‘áº¿n Sepolia RPC

**Giáº£i PhÃ¡p**:
```javascript
// Kiá»ƒm tra RPC Ä‘ang hoáº¡t Ä‘á»™ng:
curl -X POST https://ethereum-sepolia.publicnode.com \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

---

## ğŸ“Š Demo Page

Truy cáº­p: http://localhost:5173/metamask-test

Trang nÃ y cung cáº¥p:
- âœ… MetaMask káº¿t ná»‘i / ngáº¯t káº¿t ná»‘i
- âœ… Hiá»ƒn thá»‹ Ä‘á»‹a chá»‰ vÃ­ & sá»‘ dÆ°
- âœ… Chuyá»ƒn sang Sepolia
- âœ… HÆ°á»›ng dáº«n láº¥y Sepolia ETH
- âœ… Form phÃ¡t hÃ nh chá»©ng chá»‰ trá»±c tiáº¿p

---

## ğŸ”— CÃ¡c Link Há»¯u Ãch

| TÃ i NguyÃªn | URL |
|-----------|-----|
| MetaMask Docs | https://docs.metamask.io/ |
| Sepolia Faucet (Alchemy) | https://www.alchemy.com/faucets/ethereum-sepolia |
| Sepolia Explorer | https://sepolia.etherscan.io |
| Contract Address | https://sepolia.etherscan.io/address/0x895c3f9770a59F0062171c13395170E39B2dd084 |
| Web3.js Docs | https://web3js.readthedocs.io |
| ethers.js Docs | https://docs.ethers.org |

---

**Version**: 1.0  
**Last Updated**: December 2025  
**Status**: Production Ready
